<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="icon" type="image/png" href="/assets/images/logo-16x16.png" />
  <title>eQuis - Red Social</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Major+Mono+Display" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/boxicons@1.9.2/css/boxicons.min.css" rel="stylesheet">

  <!-- Styles -->
  <link href="/assets/css/bootstrap/bootstrap.min.css" rel="stylesheet">
  <link href="/assets/css/style.css" rel="stylesheet">
  <link href="/assets/css/components.css" rel="stylesheet">
  <link href="/assets/css/profile.css" rel="stylesheet">
  <link href="/assets/css/media.css" rel="stylesheet">
  <script src="/assets/js/load.js" type="text/javascript"></script>
</head>

<body class="profile">
  <div class="container-fluid newsfeed d-flex" id="wrapper">
    <!-- IMPORTANT: w-100 so it doesn't shrink -->
    <div class="row newsfeed-size w-100">
      <div class="col-md-12 p-0">

        <!-- NAVBAR (PARTIAL) -->
        {{> partials/navbar}}

        <!-- IMPORTANT: w-100 so it stretches -->
        <div class="row profile-right-side-content w-100">

          <!-- SIDEBAR (PARTIAL) -->
          {{> partials/sidebar}}

          <!-- PROFILE -->
          <div class="user-profile col-md-10">
            <div class="profile-header-background">
              <img src="/user/{{profileUser.id}}/cover-image"
                   alt="Profile Header Background"
                   onerror="this.onerror=null;this.src='/assets/images/users/cover/cover-1.gif';">
            </div>

            <div class="row profile-rows">
              <div class="col-md-3">
                <div class="profile-info-left">
                  <div class="text-center">
                    <div class="profile-img w-shadow">
                      <div class="profile-img-overlay"></div>
                      <img src="/user/{{profileUser.id}}/profile-image"
                           alt="Avatar"
                           class="avatar img-circle"
                           onerror="this.onerror=null;this.src='/assets/images/users/user-4.jpg';">
                    </div>

                    <p class="profile-fullname mt-3">{{profileUser.name}} {{profileUser.surname}}</p>
                    <p class="profile-username mb-3 text-muted">@{{profileUser.nickname}}</p>

                    {{#canManageProfile}}
                      <a href="/profile/edit" class="btn btn-sm btn-outline-primary">Editar perfil</a>
                    {{/canManageProfile}}
                  </div>

                  <div class="intro mt-5 mv-hidden">
                    <div class="intro-item d-flex justify-content-between align-items-center">
                      <h3 class="intro-about">Descripción:</h3>
                    </div>

                    {{#profileUser.description}}
                    <div class="intro-item d-flex justify-content-between align-items-center">
                      <p class="intro-title text-muted">{{profileUser.description}}</p>
                    </div>
                    {{/profileUser.description}}

                    {{^profileUser.description}}
                    <div class="intro-item d-flex justify-content-between align-items-center">
                      <p class="intro-title text-muted">Sin descripción.</p>
                    </div>
                    {{/profileUser.description}}
                  </div>
                </div>
              </div>

              <div class="col-md-9 p-0">
                <div class="profile-info-right">
                  <div class="row">
                    <div class="col-md-9 profile-center">

                      <hr class="my-5">

                      <!-- ONLY if it is their own profile -->
                      {{#isOwnProfile}}
                      <ul class="list-unstyled" style="margin-bottom: 0;">
                        <li class="media post-form w-shadow">
                          <div class="media-body">
                            <form action="/posts" method="post" enctype="multipart/form-data">
                              <input type="hidden" name="{{csrfParameterName}}" value="{{csrfToken}}">

                              <div class="form-group post-input">
                                <textarea class="form-control" id="postForm" name="content" rows="2"
                                          placeholder="What's on your mind?"></textarea>
                              </div>

                              <div class="row post-form-group">
                                <div class="col-md-9">
                                  <label class="btn btn-link post-form-btn btn-sm mb-0">
                                    <i class='bx bx-images'></i> <span>Photo/Video</span>
                                    <input type="file" name="picture" accept="image/*,video/*" hidden>
                                  </label>
                                </div>
                                <div class="col-md-3 text-right">
                                  <button type="submit" class="btn btn-primary btn-sm">Publish</button>
                                </div>
                              </div>
                            </form>
                          </div>
                        </li>
                      </ul>
                      {{/isOwnProfile}}

                      <!-- COUNTS -->
                      <div class="bg-white profile-posts-options mt-5 mb-4 py-3 d-flex justify-content-between shadow-sm">
                        <div class="col-md-3 col-sm-12 d-flex justify-content-between align-items-center">
                          <h6 class="timeline-title mb-0">Publicaciones:</h6>
                          <span class="text-muted">{{postsCount}}</span>
                        </div>
                        <div class="col-md-9 col-sm-12">
                          <div class="timeline-manage"></div>
                        </div>
                      </div>

                      <div class="bg-white profile-posts-options mt-5 mb-4 py-3 d-flex justify-content-between shadow-sm">
                        <div class="col-md-3 col-sm-12 d-flex justify-content-between align-items-center">
                          <h6 class="timeline-title mb-0">Comentarios:</h6>
                          <span class="text-muted">{{commentsCount}}</span>
                        </div>
                        <div class="col-md-9 col-sm-12">
                          <div class="timeline-manage"></div>
                        </div>
                      </div>

                      <!-- POSTS -->
                      {{#posts}}
                      <div class="post border-bottom p-3 bg-white w-shadow">
                        <div class="media text-muted pt-3">
                          <img src="/user/{{user.id}}/profile-image"
                               alt="Online user"
                               class="mr-3 post-user-image"
                               onerror="this.onerror=null;this.src='/assets/images/users/user-4.jpg';">

                          <div class="media-body pb-3 mb-0 small lh-125">
                            <div class="d-flex justify-content-between align-items-center w-100">
                              <span class="post-type text-muted">
                                <a href="/users/{{user.id}}" class="text-gray-dark post-user-name mr-2">{{user.nickname}}</a>
                              </span>
                            </div>
                            <span class="d-block">{{createdAtHuman}} <i class='bx bx-globe ml-3'></i></span>
                          </div>

                          {{#canEdit}}
                            <a href="/posts/{{id}}/edit" class="btn btn-sm" style="color: green;">Editar</a>
                          {{/canEdit}}

                          {{#canDelete}}
                            <form action="/posts/{{id}}/delete" method="post" style="display:inline;">
                              <input type="hidden" name="{{csrfParameterName}}" value="{{csrfToken}}">
                              <button type="submit" class="btn btn-sm text-danger" title="Eliminar">Eliminar</button>
                            </form>
                          {{/canDelete}}
                        </div>

                        <div class="mt-3">
                          <p>{{content}}</p>
                        </div>

                        {{#pictureUrl}}
                        <div class="d-block mt-3">
                          <img src="{{pictureUrl}}" class="post-content" alt="post image">
                        </div>
                        {{/pictureUrl}}

                        <div class="mb-2">
                          <div class="argon-reaction">
                            <span class="like-btn">
                              <a href="/posts/{{id}}/like?redirect=profile" class="post-card-buttons">
                                <i class='bx bxs-like mr-2'></i> {{likesCount}}
                              </a>
                            </span>
                          </div>
                          <a href="javascript:void(0)" class="post-card-buttons show-comments-btn" data-post="{{id}}">
                            <i class='bx bx-message-rounded mr-2'></i> {{commentsCount}}
                          </a>
                        </div>

                        <div class="border-top pt-3 hide-comments" id="comments-{{id}}" style="display: none;">
                          <div class="row bootstrap snippets">
                            <div class="col-md-12">
                              <div class="comment-wrapper">
                                <div class="panel panel-info">
                                  <div class="panel-body">
                                    <ul class="media-list comments-list">

                                      {{#isOwnProfile}}
                                      <li class="media comment-form">
                                        <a href="#" class="pull-left">
                                          <img src="/user/{{currentUser.id}}/profile-image"
                                               alt=""
                                               class="img-circle"
                                               onerror="this.onerror=null;this.src='/assets/images/users/user-4.jpg';">
                                        </a>
                                        <div class="media-body">
                                          <form action="/posts/{{id}}/comments" method="post" role="form">
                                            <input type="hidden" name="{{csrfParameterName}}" value="{{csrfToken}}">
                                            <div class="row">
                                              <div class="col-md-12">
                                                <div class="input-group">
                                                  <input type="text" name="content" class="form-control comment-input" placeholder="Write a comment...">
                                                  <div class="input-group-btn">
                                                    <button type="submit" class="btn comment-form-btn" title="Send"><i class='bx bx-send'></i></button>
                                                  </div>
                                                </div>
                                              </div>
                                            </div>
                                          </form>
                                        </div>
                                      </li>
                                      {{/isOwnProfile}}

                                      {{#comments}}
                                      <li class="media">
                                        <a href="/users/{{user.id}}" class="pull-left">
                                          <img src="/user/{{user.id}}/profile-image"
                                               alt=""
                                               class="img-circle"
                                               onerror="this.onerror=null;this.src='/assets/images/users/user-2.jpg';">
                                        </a>

                                        <div class="media-body">
                                          <div class="d-flex justify-content-between align-items-center w-100">
                                            <strong class="text-gray-dark">
                                              <a href="/users/{{user.id}}" class="fs-8">{{user.nickname}}</a>
                                            </strong>
                                          </div>

                                          <span class="d-block comment-created-time">{{createdAtHuman}}</span>
                                          <p class="fs-8 pt-2">{{content}}</p>

                                          <div class="argon-reaction">
                                            <span class="like-btn">
                                              <a href="/posts/comments/{{id}}/like?redirect=profile" class="post-card-buttons">
                                                <i class='bx bxs-like mr-2'></i> {{likesCount}}
                                              </a>
                                            </span>
                                          </div>

                                          {{#canDelete}}
                                          <form action="/comments/{{id}}/delete" method="post" style="display:inline;">
                                            <input type="hidden" name="{{csrfParameterName}}" value="{{csrfToken}}">
                                            <button type="submit" class="btn btn-sm text-danger" title="Eliminar">Eliminar</button>
                                          </form>
                                          {{/canDelete}}
                                        </div>
                                      </li>
                                      {{/comments}}

                                      {{^comments}}
                                      <li class="media">
                                        <div class="media-body">
                                          <p class="text-muted fs-8 mb-0">No comments yet.</p>
                                        </div>
                                      </li>
                                      {{/comments}}

                                    </ul>
                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                      </div>
                      {{/posts}}

                      {{^posts}}
                      <div class="post border-bottom p-3 bg-white w-shadow">
                        <p class="mb-0 text-muted">Todavía no hay publicaciones.</p>
                      </div>
                      {{/posts}}

                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>

        </div>

        <hr class="my-5">

      </div>
    </div>
  </div>

  <!-- Core -->
  <script src="/assets/js/jquery/jquery-3.3.1.min.js"></script>
  <script src="/assets/js/popper/popper.min.js"></script>
  <script src="/assets/js/bootstrap/bootstrap.min.js"></script>
  <script src="/assets/js/app.js"></script>
  <script src="/assets/js/components/components.js"></script>

  <script>
    $("#menu-toggle").click(function (e) {
      e.preventDefault();
      $("#wrapper").toggleClass("toggled");
    });

    document.addEventListener("DOMContentLoaded", () => {
      document.querySelectorAll(".show-comments-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          const postId = btn.getAttribute("data-post");
          const el = document.getElementById("comments-" + postId);
          if (!el) return;
          el.style.display = (el.style.display === "none" || el.style.display === "") ? "block" : "none";
        });
      });
    });
  </script>

</body>
</html>